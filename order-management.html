<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management - Aether</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/custom.css">
    
    <style>
        /* ì£¼ë¬¸ ê´€ë¦¬ ì‹œìŠ¤í…œ ì „ìš© ìŠ¤íƒ€ì¼ */
        .order-management-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        
        .order-header {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .order-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #6c757d;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .stat-card.pending { border-left-color: #ffc107; }
        .stat-card.processing { border-left-color: #17a2b8; }
        .stat-card.shipping { border-left-color: #007bff; }
        .stat-card.completed { border-left-color: #28a745; }
        .stat-card.cancelled { border-left-color: #dc3545; }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #212529;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .order-filters {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }
        
        .order-list-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .order-item {
            border-bottom: 1px solid #e9ecef;
            padding: 1.5rem;
            transition: background-color 0.3s ease;
        }
        
        .order-item:hover {
            background-color: #f8f9fa;
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending { background: #fff3cd; color: #856404; }
        .status-processing { background: #d1ecf1; color: #0c5460; }
        .status-shipping { background: #cce5ff; color: #004085; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        
        .order-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .btn-action {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-view { background: #6c757d; color: white; border: none; }
        .btn-view:hover { background: #5a6268; color: white; }
        
        .btn-process { background: #17a2b8; color: white; border: none; }
        .btn-process:hover { background: #138496; color: white; }
        
        .btn-ship { background: #007bff; color: white; border: none; }
        .btn-ship:hover { background: #0056b3; color: white; }
        
        .btn-complete { background: #28a745; color: white; border: none; }
        .btn-complete:hover { background: #1e7e34; color: white; }
        
        .btn-cancel { background: #dc3545; color: white; border: none; }
        .btn-cancel:hover { background: #c82333; color: white; }
        
        .japanese-heading {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            font-weight: 600;
            color: #212529;
        }
        
        .japanese-text {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            color: #6c757d;
        }
        
        .empty-orders {
            text-align: center;
            padding: 4rem 2rem;
            color: #6c757d;
        }
        
        .empty-orders i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .order-management-container {
                padding: 1rem 0;
            }
            
            .order-header {
                padding: 1.5rem;
                margin-bottom: 1rem;
            }
            
            .order-stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .order-item {
                padding: 1rem;
            }
            
            .order-actions {
                justify-content: center;
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="order-management-container">
        <div class="container-fluid">
            <!-- í—¤ë” -->
            <div class="order-header">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h1 class="japanese-heading mb-2">
                            <i class="fas fa-shopping-cart me-3"></i>æ³¨æ–‡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
                        </h1>
                        <p class="japanese-text mb-0">Order Management System</p>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-secondary" onclick="refreshOrders()">
                            <i class="fas fa-sync-alt me-2"></i>æ›´æ–°
                        </button>
                        <button class="btn btn-dark" onclick="exportOrders()">
                            <i class="fas fa-download me-2"></i>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                        </button>
                        <a href="admin-dashboard.html" class="btn btn-outline-dark">
                            <i class="fas fa-arrow-left me-2"></i>ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                        </a>
                    </div>
                </div>
                
                <!-- ì£¼ë¬¸ í†µê³„ -->
                <div class="order-stats-grid">
                    <div class="stat-card pending">
                        <div class="stat-number" id="pending-count">0</div>
                        <div class="stat-label">å‡¦ç†å¾…ã¡</div>
                    </div>
                    <div class="stat-card processing">
                        <div class="stat-number" id="processing-count">0</div>
                        <div class="stat-label">å‡¦ç†ä¸­</div>
                    </div>
                    <div class="stat-card shipping">
                        <div class="stat-number" id="shipping-count">0</div>
                        <div class="stat-label">é…é€ä¸­</div>
                    </div>
                    <div class="stat-card completed">
                        <div class="stat-number" id="completed-count">0</div>
                        <div class="stat-label">å®Œäº†</div>
                    </div>
                    <div class="stat-card cancelled">
                        <div class="stat-number" id="cancelled-count">0</div>
                        <div class="stat-label">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</div>
                    </div>
                </div>
            </div>
            
            <!-- í•„í„° -->
            <div class="order-filters">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label japanese-text">æ³¨æ–‡çŠ¶æ…‹</label>
                        <select class="form-select" id="status-filter" onchange="filterOrders()">
                            <option value="">å…¨ã¦</option>
                            <option value="pending">å‡¦ç†å¾…ã¡</option>
                            <option value="processing">å‡¦ç†ä¸­</option>
                            <option value="shipping">é…é€ä¸­</option>
                            <option value="completed">å®Œäº†</option>
                            <option value="cancelled">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label japanese-text">æœŸé–“</label>
                        <select class="form-select" id="date-filter" onchange="filterOrders()">
                            <option value="today">ä»Šæ—¥</option>
                            <option value="week">ä»Šé€±</option>
                            <option value="month">ä»Šæœˆ</option>
                            <option value="all">å…¨æœŸé–“</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label japanese-text">æ¤œç´¢</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="search-input" 
                                   placeholder="æ³¨æ–‡ç•ªå·ã€é¡§å®¢åã§æ¤œç´¢" onkeyup="searchOrders()">
                            <button class="btn btn-outline-secondary" onclick="clearSearch()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label japanese-text">&nbsp;</label>
                        <div>
                            <button class="btn btn-outline-secondary w-100" onclick="clearAllFilters()">
                                <i class="fas fa-filter me-1"></i>ãƒªã‚»ãƒƒãƒˆ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì£¼ë¬¸ ëª©ë¡ -->
            <div class="order-list-container">
                <div id="orders-container">
                    <div class="loading-spinner">
                        <div class="spinner-border text-secondary" role="status">
                            <span class="visually-hidden">èª­ã¿è¾¼ã¿ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ì£¼ë¬¸ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title japanese-heading" id="orderDetailModalLabel">æ³¨æ–‡è©³ç´°</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="order-detail-content">
                    <!-- ì£¼ë¬¸ ìƒì„¸ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
                    <button type="button" class="btn btn-dark" onclick="printOrder()">å°åˆ·</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Firebase Config -->
    <script src="assets/js/firebase-config.js"></script>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let allOrders = [];
        let filteredOrders = [];
        let currentUser = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ì£¼ë¬¸ ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');
            initializeOrderManagement();
        });
        
        // ì£¼ë¬¸ ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        function initializeOrderManagement() {
            // Firebase ì¸ì¦ í™•ì¸
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    console.log('âœ… ì‚¬ìš©ì ì¸ì¦ ì™„ë£Œ:', user.email);
                    loadOrders();
                } else {
                    console.log('âŒ ì‚¬ìš©ì ì¸ì¦ í•„ìš”');
                    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    window.location.href = 'login.html';
                }
            });
        }
        
        // ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ
        function loadOrders() {
            console.log('ğŸ“Š Firebaseì—ì„œ ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ ì‹œì‘');
            
            const ordersRef = firebase.firestore().collection('orders');
            
            ordersRef.orderBy('orderDate', 'desc').get()
                .then((querySnapshot) => {
                    allOrders = [];
                    querySnapshot.forEach((doc) => {
                        const orderData = doc.data();
                        orderData.id = doc.id;
                        allOrders.push(orderData);
                    });
                    
                    console.log('âœ… ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', allOrders.length, 'ê°œ');
                    updateOrderStatistics();
                    displayOrders();
                })
                .catch((error) => {
                    console.error('âŒ ì£¼ë¬¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    showError('ì£¼ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        }
        
        // ì£¼ë¬¸ í†µê³„ ì—…ë°ì´íŠ¸
        function updateOrderStatistics() {
            const stats = {
                pending: 0,
                processing: 0,
                shipping: 0,
                completed: 0,
                cancelled: 0
            };
            
            allOrders.forEach(order => {
                if (stats.hasOwnProperty(order.status)) {
                    stats[order.status]++;
                }
            });
            
            document.getElementById('pending-count').textContent = stats.pending;
            document.getElementById('processing-count').textContent = stats.processing;
            document.getElementById('shipping-count').textContent = stats.shipping;
            document.getElementById('completed-count').textContent = stats.completed;
            document.getElementById('cancelled-count').textContent = stats.cancelled;
        }
        
        // ì£¼ë¬¸ ëª©ë¡ í‘œì‹œ
        function displayOrders() {
            const container = document.getElementById('orders-container');
            
            if (filteredOrders.length === 0) {
                container.innerHTML = `
                    <div class="empty-orders">
                        <i class="fas fa-shopping-cart"></i>
                        <h4 class="japanese-heading">æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</h4>
                        <p class="japanese-text">æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹æ³¨æ–‡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredOrders.forEach(order => {
                html += createOrderItemHTML(order);
            });
            
            container.innerHTML = html;
        }
        
        // ì£¼ë¬¸ ì•„ì´í…œ HTML ìƒì„±
        function createOrderItemHTML(order) {
            const orderDate = new Date(order.orderDate).toLocaleDateString('ja-JP');
            const totalAmount = order.totalAmount ? order.totalAmount.toLocaleString() : '0';
            const customerName = order.customer ? order.customer.name : 'ä¸æ˜';
            const customerEmail = order.customer ? order.customer.email : '';
            
            return `
                <div class="order-item">
                    <div class="row align-items-center">
                        <div class="col-md-2">
                            <div class="fw-bold">${order.id}</div>
                            <small class="text-muted">${orderDate}</small>
                        </div>
                        <div class="col-md-2">
                            <div class="fw-bold">${customerName}</div>
                            <small class="text-muted">${customerEmail}</small>
                        </div>
                        <div class="col-md-2">
                            <span class="order-status status-${order.status}">
                                ${getStatusText(order.status)}
                            </span>
                        </div>
                        <div class="col-md-2">
                            <div class="fw-bold">Â¥${totalAmount}</div>
                            <small class="text-muted">${order.items ? order.items.length : 0} å•†å“</small>
                        </div>
                        <div class="col-md-4">
                            <div class="order-actions">
                                <button class="btn btn-action btn-view" onclick="viewOrderDetail('${order.id}')">
                                    <i class="fas fa-eye me-1"></i>è©³ç´°
                                </button>
                                ${getActionButtons(order.status, order.id)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ìƒíƒœë³„ ì•¡ì…˜ ë²„íŠ¼ ìƒì„±
        function getActionButtons(status, orderId) {
            switch(status) {
                case 'pending':
                    return `
                        <button class="btn btn-action btn-process" onclick="updateOrderStatus('${orderId}', 'processing')">
                            <i class="fas fa-check me-1"></i>å‡¦ç†é–‹å§‹
                        </button>
                        <button class="btn btn-action btn-cancel" onclick="updateOrderStatus('${orderId}', 'cancelled')">
                            <i class="fas fa-times me-1"></i>ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </button>
                    `;
                case 'processing':
                    return `
                        <button class="btn btn-action btn-ship" onclick="updateOrderStatus('${orderId}', 'shipping')">
                            <i class="fas fa-truck me-1"></i>é…é€é–‹å§‹
                        </button>
                    `;
                case 'shipping':
                    return `
                        <button class="btn btn-action btn-complete" onclick="updateOrderStatus('${orderId}', 'completed')">
                            <i class="fas fa-check-circle me-1"></i>å®Œäº†
                        </button>
                    `;
                case 'completed':
                    return `<span class="text-muted">å®Œäº†æ¸ˆã¿</span>`;
                case 'cancelled':
                    return `<span class="text-muted">ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ¸ˆã¿</span>`;
                default:
                    return '';
            }
        }
        
        // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
        function getStatusText(status) {
            const statusMap = {
                'pending': 'å‡¦ç†å¾…ã¡',
                'processing': 'å‡¦ç†ä¸­',
                'shipping': 'é…é€ä¸­',
                'completed': 'å®Œäº†',
                'cancelled': 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'
            };
            return statusMap[status] || status;
        }
        
        // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateOrderStatus(orderId, newStatus) {
            if (!confirm('æ³¨æ–‡çŠ¶æ…‹ã‚’å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            const orderRef = firebase.firestore().collection('orders').doc(orderId);
            
            orderRef.update({
                status: newStatus,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                console.log('âœ… ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', orderId, newStatus);
                
                // ë¡œì»¬ ë°ì´í„° ì—…ë°ì´íŠ¸
                const orderIndex = allOrders.findIndex(order => order.id === orderId);
                if (orderIndex !== -1) {
                    allOrders[orderIndex].status = newStatus;
                    updateOrderStatistics();
                    displayOrders();
                }
                
                // ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡ (í–¥í›„ êµ¬í˜„)
                sendOrderStatusNotification(orderId, newStatus);
                
                showSuccess('æ³¨æ–‡çŠ¶æ…‹ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚');
            })
            .catch((error) => {
                console.error('âŒ ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                showError('æ³¨æ–‡çŠ¶æ…‹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            });
        }
        
        // ì£¼ë¬¸ ìƒì„¸ ë³´ê¸°
        function viewOrderDetail(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) {
                showError('æ³¨æ–‡æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }
            
            const modalContent = createOrderDetailHTML(order);
            document.getElementById('order-detail-content').innerHTML = modalContent;
            
            const modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
            modal.show();
        }
        
        // ì£¼ë¬¸ ìƒì„¸ HTML ìƒì„±
        function createOrderDetailHTML(order) {
            const orderDate = new Date(order.orderDate).toLocaleString('ja-JP');
            const totalAmount = order.totalAmount ? order.totalAmount.toLocaleString() : '0';
            
            let itemsHTML = '';
            if (order.items && order.items.length > 0) {
                itemsHTML = order.items.map(item => `
                    <tr>
                        <td>${item.name}</td>
                        <td class="text-center">${item.quantity}</td>
                        <td class="text-end">Â¥${item.price ? item.price.toLocaleString() : '0'}</td>
                        <td class="text-end">Â¥${(item.price * item.quantity).toLocaleString()}</td>
                    </tr>
                `).join('');
            }
            
            return `
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="japanese-heading">æ³¨æ–‡æƒ…å ±</h6>
                        <table class="table table-sm">
                            <tr><td>æ³¨æ–‡ç•ªå·:</td><td>${order.id}</td></tr>
                            <tr><td>æ³¨æ–‡æ—¥æ™‚:</td><td>${orderDate}</td></tr>
                            <tr><td>çŠ¶æ…‹:</td><td><span class="order-status status-${order.status}">${getStatusText(order.status)}</span></td></tr>
                            <tr><td>åˆè¨ˆé‡‘é¡:</td><td class="fw-bold">Â¥${totalAmount}</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6 class="japanese-heading">é¡§å®¢æƒ…å ±</h6>
                        <table class="table table-sm">
                            <tr><td>åå‰:</td><td>${order.customer ? order.customer.name : 'ä¸æ˜'}</td></tr>
                            <tr><td>ãƒ¡ãƒ¼ãƒ«:</td><td>${order.customer ? order.customer.email : 'ä¸æ˜'}</td></tr>
                            <tr><td>é›»è©±:</td><td>${order.customer ? order.customer.phone : 'ä¸æ˜'}</td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6 class="japanese-heading">æ³¨æ–‡å•†å“</h6>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>å•†å“å</th>
                                    <th class="text-center">æ•°é‡</th>
                                    <th class="text-end">å˜ä¾¡</th>
                                    <th class="text-end">å°è¨ˆ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHTML}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // í•„í„°ë§ í•¨ìˆ˜ë“¤
        function filterOrders() {
            const statusFilter = document.getElementById('status-filter').value;
            const dateFilter = document.getElementById('date-filter').value;
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            filteredOrders = allOrders.filter(order => {
                // ìƒíƒœ í•„í„°
                if (statusFilter && order.status !== statusFilter) {
                    return false;
                }
                
                // ë‚ ì§œ í•„í„°
                if (dateFilter !== 'all') {
                    const orderDate = new Date(order.orderDate);
                    const now = new Date();
                    
                    switch(dateFilter) {
                        case 'today':
                            if (orderDate.toDateString() !== now.toDateString()) return false;
                            break;
                        case 'week':
                            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                            if (orderDate < weekAgo) return false;
                            break;
                        case 'month':
                            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                            if (orderDate < monthAgo) return false;
                            break;
                    }
                }
                
                // ê²€ìƒ‰ í•„í„°
                if (searchTerm) {
                    const searchableText = `${order.id} ${order.customer ? order.customer.name : ''} ${order.customer ? order.customer.email : ''}`.toLowerCase();
                    if (!searchableText.includes(searchTerm)) return false;
                }
                
                return true;
            });
            
            displayOrders();
        }
        
        function searchOrders() {
            filterOrders();
        }
        
        function clearSearch() {
            document.getElementById('search-input').value = '';
            filterOrders();
        }
        
        function clearAllFilters() {
            document.getElementById('status-filter').value = '';
            document.getElementById('date-filter').value = 'today';
            document.getElementById('search-input').value = '';
            filterOrders();
        }
        
        function refreshOrders() {
            loadOrders();
        }
        
        function exportOrders() {
            // CSV ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ (í–¥í›„ êµ¬í˜„)
            showInfo('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯æº–å‚™ä¸­ã§ã™ã€‚');
        }
        
        function printOrder() {
            window.print();
        }
        
        // ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡ (í–¥í›„ êµ¬í˜„)
        function sendOrderStatusNotification(orderId, newStatus) {
            console.log('ğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡ ì˜ˆì •:', orderId, newStatus);
            // Gmail API ì—°ë™ í›„ êµ¬í˜„
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showSuccess(message) {
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (í–¥í›„ êµ¬í˜„)
            console.log('âœ…', message);
        }
        
        function showError(message) {
            // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (í–¥í›„ êµ¬í˜„)
            console.error('âŒ', message);
        }
        
        function showInfo(message) {
            // ì •ë³´ ë©”ì‹œì§€ í‘œì‹œ (í–¥í›„ êµ¬í˜„)
            console.log('â„¹ï¸', message);
        }
        
        // ì´ˆê¸° í•„í„°ë§ ì ìš©
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                filterOrders();
            }, 1000);
        });
    </script>
</body>
</html>
