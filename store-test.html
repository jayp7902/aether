<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í† ì–´ ê¶Œí•œ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <style>
        body {
            font-family: "Montserrat", sans-serif;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .result {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-danger { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">ğŸ”§ ìŠ¤í† ì–´ ê¶Œí•œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>
        
        <!-- ë¡œê·¸ì¸ -->
        <div class="test-section">
            <h3>0. ë¡œê·¸ì¸ (í•„ìˆ˜)</h3>
            <div class="row">
                <div class="col-md-6">
                    <input type="email" id="login-email" class="form-control mb-2" placeholder="ì´ë©”ì¼" value="storeadmin@aether.com">
                    <input type="password" id="login-password" class="form-control mb-2" placeholder="ë¹„ë°€ë²ˆí˜¸">
                    <button class="btn-success" onclick="loginUser()">ë¡œê·¸ì¸</button>
                    <button class="btn-warning" onclick="logoutUser()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            <div id="login-result"></div>
        </div>

        <!-- í˜„ì¬ ì‚¬ìš©ì ì •ë³´ -->
        <div class="test-section">
            <h3>1. í˜„ì¬ ì‚¬ìš©ì ì •ë³´</h3>
            <button class="btn-primary" onclick="checkCurrentUser()">í˜„ì¬ ì‚¬ìš©ì í™•ì¸</button>
            <div id="current-user-result"></div>
        </div>

        <!-- Firebase Auth ìƒíƒœ -->
        <div class="test-section">
            <h3>2. Firebase Auth ìƒíƒœ</h3>
            <button class="btn-primary" onclick="checkFirebaseAuth()">Firebase Auth í™•ì¸</button>
            <div id="firebase-auth-result"></div>
        </div>

        <!-- Firestore ì‚¬ìš©ì ë°ì´í„° -->
        <div class="test-section">
            <h3>3. Firestore ì‚¬ìš©ì ë°ì´í„°</h3>
            <button class="btn-primary" onclick="checkFirestoreUser()">Firestore ì‚¬ìš©ì ë°ì´í„° í™•ì¸</button>
            <div id="firestore-user-result"></div>
        </div>

        <!-- ìŠ¤í† ì–´ ê¶Œí•œ í™•ì¸ -->
        <div class="test-section">
            <h3>4. ìŠ¤í† ì–´ ê¶Œí•œ í™•ì¸</h3>
            <button class="btn-success" onclick="checkStorePermission()">ìŠ¤í† ì–´ ê¶Œí•œ í™•ì¸</button>
            <div id="store-permission-result"></div>
        </div>

        <!-- ìŠ¤í† ì–´ ê¶Œí•œ ì¶”ê°€ -->
        <div class="test-section">
            <h3>5. ìŠ¤í† ì–´ ê¶Œí•œ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ìš©)</h3>
            <button class="btn-warning" onclick="addStorePermission()">í˜„ì¬ ì‚¬ìš©ìì—ê²Œ ìŠ¤í† ì–´ ê¶Œí•œ ì¶”ê°€</button>
            <div id="add-permission-result"></div>
        </div>

        <!-- ì „ì²´ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h3>6. ì „ì²´ í…ŒìŠ¤íŠ¸</h3>
            <button class="btn-danger" onclick="runFullTest()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <div id="full-test-result"></div>
        </div>

        <!-- ë¡œê·¸ -->
        <div class="test-section">
            <h3>7. ìƒì„¸ ë¡œê·¸</h3>
            <button class="btn-primary" onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
            <div id="log-container" style="background: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px;"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="assets/js/firebase-config.js"></script>

    <script>
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
            if (type === 'error') logEntry.style.color = '#dc3545';
            if (type === 'success') logEntry.style.color = '#28a745';
            if (type === 'warning') logEntry.style.color = '#ffc107';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        function clearLog() {
            document.getElementById('log-container').innerHTML = '';
        }

        // ë¡œê·¸ì¸ í•¨ìˆ˜
        async function loginUser() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showResult('login-result', 'âŒ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            log(`ë¡œê·¸ì¸ ì‹œë„: ${email}`);
            
            try {
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                showResult('login-result', `
                    âœ… ë¡œê·¸ì¸ ì„±ê³µ!<br>
                    <strong>ì´ë©”ì¼:</strong> ${user.email}<br>
                    <strong>UID:</strong> ${user.uid}
                `, 'success');
                
                log(`ë¡œê·¸ì¸ ì„±ê³µ: ${user.email} (${user.uid})`, 'success');
                
                // ë¡œê·¸ì¸ ì„±ê³µ í›„ ìë™ìœ¼ë¡œ í˜„ì¬ ì‚¬ìš©ì í™•ì¸
                setTimeout(() => {
                    checkCurrentUser();
                }, 1000);
                
            } catch (error) {
                showResult('login-result', `âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                log(`ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        async function logoutUser() {
            try {
                await firebase.auth().signOut();
                showResult('login-result', 'âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ', 'success');
                log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ', 'success');
                
                // ë¡œê·¸ì•„ì›ƒ í›„ ê²°ê³¼ ì´ˆê¸°í™”
                document.getElementById('current-user-result').innerHTML = '';
                document.getElementById('firebase-auth-result').innerHTML = '';
                document.getElementById('firestore-user-result').innerHTML = '';
                document.getElementById('store-permission-result').innerHTML = '';
                
            } catch (error) {
                showResult('login-result', `âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ${error.message}`, 'error');
                log(`ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // 1. í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í™•ì¸
        async function checkCurrentUser() {
            log('=== í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í™•ì¸ ì‹œì‘ ===');
            
            try {
                if (!firebase || !firebase.auth) {
                    showResult('current-user-result', 'âŒ Firebase Authê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    log('Firebase Authê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                const currentUser = firebase.auth().currentUser;
                
                if (!currentUser) {
                    showResult('current-user-result', 'âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    log('ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                const userInfo = {
                    email: currentUser.email,
                    uid: currentUser.uid,
                    displayName: currentUser.displayName,
                    emailVerified: currentUser.emailVerified,
                    creationTime: currentUser.metadata.creationTime,
                    lastSignInTime: currentUser.metadata.lastSignInTime
                };

                showResult('current-user-result', `
                    âœ… ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´:<br>
                    <strong>ì´ë©”ì¼:</strong> ${userInfo.email}<br>
                    <strong>UID:</strong> ${userInfo.uid}<br>
                    <strong>í‘œì‹œëª…:</strong> ${userInfo.displayName || 'ì—†ìŒ'}<br>
                    <strong>ì´ë©”ì¼ ì¸ì¦:</strong> ${userInfo.emailVerified ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}<br>
                    <strong>ê³„ì • ìƒì„±:</strong> ${userInfo.creationTime}<br>
                    <strong>ë§ˆì§€ë§‰ ë¡œê·¸ì¸:</strong> ${userInfo.lastSignInTime}
                `, 'success');
                
                log(`ë¡œê·¸ì¸ëœ ì‚¬ìš©ì: ${userInfo.email} (${userInfo.uid})`, 'success');
                
            } catch (error) {
                showResult('current-user-result', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`í˜„ì¬ ì‚¬ìš©ì í™•ì¸ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 2. Firebase Auth ìƒíƒœ í™•ì¸
        async function checkFirebaseAuth() {
            log('=== Firebase Auth ìƒíƒœ í™•ì¸ ì‹œì‘ ===');
            
            try {
                const authStatus = {
                    firebase: typeof firebase !== 'undefined',
                    auth: typeof firebase !== 'undefined' && !!firebase.auth,
                    currentUser: firebase?.auth?.currentUser ? firebase.auth().currentUser.email : null,
                    authState: 'í™•ì¸ ì¤‘...'
                };

                log(`Firebase ê°ì²´: ${authStatus.firebase ? 'ì¡´ì¬' : 'ì—†ìŒ'}`, authStatus.firebase ? 'success' : 'error');
                log(`Firebase Auth: ${authStatus.auth ? 'ì¡´ì¬' : 'ì—†ìŒ'}`, authStatus.auth ? 'success' : 'error');
                log(`í˜„ì¬ ì‚¬ìš©ì: ${authStatus.currentUser || 'ì—†ìŒ'}`, authStatus.currentUser ? 'success' : 'warning');

                showResult('firebase-auth-result', `
                    Firebase ê°ì²´: ${authStatus.firebase ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}<br>
                    Firebase Auth: ${authStatus.auth ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}<br>
                    í˜„ì¬ ì‚¬ìš©ì: ${authStatus.currentUser ? `âœ… ${authStatus.currentUser}` : 'âŒ ì—†ìŒ'}
                `, authStatus.firebase && authStatus.auth ? 'success' : 'error');
                
            } catch (error) {
                showResult('firebase-auth-result', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`Firebase Auth ìƒíƒœ í™•ì¸ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 3. Firestore ì‚¬ìš©ì ë°ì´í„° í™•ì¸
        async function checkFirestoreUser() {
            log('=== Firestore ì‚¬ìš©ì ë°ì´í„° í™•ì¸ ì‹œì‘ ===');
            
            try {
                if (!firebase || !firebase.firestore) {
                    showResult('firestore-user-result', 'âŒ Firebase Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    log('Firebase Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                const currentUser = firebase.auth().currentUser;
                if (!currentUser) {
                    showResult('firestore-user-result', 'âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    log('ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                const db = firebase.firestore();
                log(`Firestoreì—ì„œ ì‚¬ìš©ì ë¬¸ì„œ ì¡°íšŒ: ${currentUser.email}`);
                
                const userDoc = await db.collection('users').doc(currentUser.email).get();
                
                if (!userDoc.exists) {
                    showResult('firestore-user-result', 'âŒ Firestoreì— ì‚¬ìš©ì ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    log(`ì‚¬ìš©ì ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ: ${currentUser.email}`, 'error');
                    return;
                }

                const userData = userDoc.data();
                log(`ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì„±ê³µ: ${JSON.stringify(userData, null, 2)}`, 'success');

                showResult('firestore-user-result', `
                    âœ… Firestore ì‚¬ìš©ì ë°ì´í„°:<br>
                    <strong>ì´ë©”ì¼:</strong> ${userData.email || 'ì—†ìŒ'}<br>
                    <strong>ì´ë¦„:</strong> ${userData.name || 'ì—†ìŒ'}<br>
                    <strong>ìŠ¤í† ì–´ ì—­í• :</strong> ${userData.storeRole || 'ì—†ìŒ'}<br>
                    <strong>ìŠ¤í† ì–´ í™œì„±:</strong> ${userData.isStoreActive !== undefined ? (userData.isStoreActive ? 'í™œì„±' : 'ë¹„í™œì„±') : 'ì—†ìŒ'}<br>
                    <strong>ìŠ¤í† ì–´ ID:</strong> ${userData.storeId || 'ì—†ìŒ'}<br>
                    <strong>ìŠ¤í† ì–´ ê¶Œí•œ:</strong> ${userData.storePermissions ? JSON.stringify(userData.storePermissions) : 'ì—†ìŒ'}<br>
                    <strong>ìƒì„±ì¼:</strong> ${userData.createdAt ? userData.createdAt.toDate().toLocaleString() : 'ì—†ìŒ'}<br>
                    <strong>ìˆ˜ì •ì¼:</strong> ${userData.updatedAt ? userData.updatedAt.toDate().toLocaleString() : 'ì—†ìŒ'}
                `, 'success');
                
            } catch (error) {
                showResult('firestore-user-result', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`Firestore ì‚¬ìš©ì ë°ì´í„° í™•ì¸ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 4. ìŠ¤í† ì–´ ê¶Œí•œ í™•ì¸
        async function checkStorePermission() {
            log('=== ìŠ¤í† ì–´ ê¶Œí•œ í™•ì¸ ì‹œì‘ ===');
            
            try {
                const currentUser = firebase.auth().currentUser;
                if (!currentUser) {
                    showResult('store-permission-result', 'âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    log('ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                const db = firebase.firestore();
                const userDoc = await db.collection('users').doc(currentUser.email).get();
                
                if (!userDoc.exists) {
                    showResult('store-permission-result', 'âŒ Firestoreì— ì‚¬ìš©ì ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    log(`ì‚¬ìš©ì ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ: ${currentUser.email}`, 'error');
                    return;
                }

                const userData = userDoc.data();
                const hasStoreRole = !!userData.storeRole;
                const isStoreActive = !!userData.isStoreActive;
                const hasStorePermissions = !!userData.storePermissions;

                log(`ìŠ¤í† ì–´ ì—­í• : ${userData.storeRole || 'ì—†ìŒ'}`, hasStoreRole ? 'success' : 'error');
                log(`ìŠ¤í† ì–´ í™œì„±: ${userData.isStoreActive}`, isStoreActive ? 'success' : 'error');
                log(`ìŠ¤í† ì–´ ê¶Œí•œ: ${userData.storePermissions ? JSON.stringify(userData.storePermissions) : 'ì—†ìŒ'}`, hasStorePermissions ? 'success' : 'error');

                const hasAccess = hasStoreRole && isStoreActive;
                
                showResult('store-permission-result', `
                    ${hasAccess ? 'âœ…' : 'âŒ'} ìŠ¤í† ì–´ ì ‘ê·¼ ê¶Œí•œ: ${hasAccess ? 'ìˆìŒ' : 'ì—†ìŒ'}<br>
                    <strong>ìŠ¤í† ì–´ ì—­í• :</strong> ${userData.storeRole || 'ì—†ìŒ'} ${hasStoreRole ? 'âœ…' : 'âŒ'}<br>
                    <strong>ìŠ¤í† ì–´ í™œì„±:</strong> ${userData.isStoreActive} ${isStoreActive ? 'âœ…' : 'âŒ'}<br>
                    <strong>ìŠ¤í† ì–´ ê¶Œí•œ:</strong> ${hasStorePermissions ? 'ìˆìŒ' : 'ì—†ìŒ'} ${hasStorePermissions ? 'âœ…' : 'âŒ'}
                `, hasAccess ? 'success' : 'error');
                
                log(`ìŠ¤í† ì–´ ì ‘ê·¼ ê¶Œí•œ ê²°ê³¼: ${hasAccess ? 'í—ˆìš©' : 'ê±°ë¶€'}`, hasAccess ? 'success' : 'error');
                
            } catch (error) {
                showResult('store-permission-result', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`ìŠ¤í† ì–´ ê¶Œí•œ í™•ì¸ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 5. ìŠ¤í† ì–´ ê¶Œí•œ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ìš©)
        async function addStorePermission() {
            log('=== ìŠ¤í† ì–´ ê¶Œí•œ ì¶”ê°€ ì‹œì‘ ===');
            
            try {
                const currentUser = firebase.auth().currentUser;
                if (!currentUser) {
                    showResult('add-permission-result', 'âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    log('ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                    return;
                }

                const db = firebase.firestore();
                
                const permissionData = {
                    storeRole: 'store_admin',
                    isStoreActive: true,
                    storeId: 'main_store',
                    storePermissions: ['point_management', 'customer_management', 'transaction_history', 'user_management', 'store_settings'],
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                log(`ìŠ¤í† ì–´ ê¶Œí•œ ì¶”ê°€ ì¤‘: ${currentUser.email}`);
                log(`ê¶Œí•œ ë°ì´í„°: ${JSON.stringify(permissionData, null, 2)}`);

                await db.collection('users').doc(currentUser.email).set(permissionData, { merge: true });
                
                showResult('add-permission-result', `
                    âœ… ìŠ¤í† ì–´ ê¶Œí•œì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                    <strong>ëŒ€ìƒ:</strong> ${currentUser.email}<br>
                    <strong>ì—­í• :</strong> ${permissionData.storeRole}<br>
                    <strong>í™œì„±:</strong> ${permissionData.isStoreActive}<br>
                    <strong>ê¶Œí•œ:</strong> ${permissionData.storePermissions.join(', ')}
                `, 'success');
                
                log(`ìŠ¤í† ì–´ ê¶Œí•œ ì¶”ê°€ ì™„ë£Œ: ${currentUser.email}`, 'success');
                
            } catch (error) {
                showResult('add-permission-result', `âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
                log(`ìŠ¤í† ì–´ ê¶Œí•œ ì¶”ê°€ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // 6. ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runFullTest() {
            log('=== ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            // ê° í…ŒìŠ¤íŠ¸ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰
            await checkCurrentUser();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await checkFirebaseAuth();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await checkFirestoreUser();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await checkStorePermission();
            
            log('=== ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
            showResult('full-test-result', 'âœ… ì „ì²´ í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', 'success');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            log('ìŠ¤í† ì–´ ê¶Œí•œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            
            // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
            let attempts = 0;
            const maxAttempts = 50;
            
            const waitForFirebase = setInterval(() => {
                attempts++;
                
                if (typeof firebase !== 'undefined' && firebase.auth && firebase.firestore) {
                    clearInterval(waitForFirebase);
                    log('Firebase ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                    
                    // Firebase Auth ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                    firebase.auth().onAuthStateChanged((user) => {
                        if (user) {
                            log(`Firebase Auth ìƒíƒœ ë³€ê²½: ë¡œê·¸ì¸ë¨ (${user.email})`, 'success');
                            // ìë™ìœ¼ë¡œ í˜„ì¬ ì‚¬ìš©ì í™•ì¸
                            setTimeout(() => {
                                checkCurrentUser();
                            }, 500);
                        } else {
                            log('Firebase Auth ìƒíƒœ ë³€ê²½: ë¡œê·¸ì•„ì›ƒë¨', 'warning');
                        }
                    });
                    
                    // ì´ˆê¸° ì‚¬ìš©ì ìƒíƒœ í™•ì¸
                    setTimeout(() => {
                        checkCurrentUser();
                    }, 1000);
                    
                } else if (attempts >= maxAttempts) {
                    clearInterval(waitForFirebase);
                    log('Firebase ì´ˆê¸°í™” ì‹œê°„ ì´ˆê³¼', 'error');
                } else {
                    log(`Firebase ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘... (${attempts}/${maxAttempts})`);
                }
            }, 100);
        });
    </script>
</body>
</html>
